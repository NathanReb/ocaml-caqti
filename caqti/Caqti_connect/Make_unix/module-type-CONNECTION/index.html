<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>CONNECTION (caqti.Caqti_connect.Make_unix.CONNECTION)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../../index.html">caqti</a></span></nav><header><h1><span class="keyword">Module type</span> <span class="module-path">Caqti_connect.Make_unix.CONNECTION</span></h1></header><div class="doc"><p>The connection API specialized for the current concurrency library.</p></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="../../../Caqti_connection_sig/index.html#module-type-Base">Caqti_connection_sig.Base</a></code></span></summary><div class="spec type" id="type-future"><a href="#type-future" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a future</code><code></code><code></code></div><div class="doc"></div></div><h3>Query</h3><div class="spec module" id="module-Response"><a href="#module-Response" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Response/index.html">Response</a> : <a href="../../../Caqti_response_sig/index.html#module-type-S">Caqti_response_sig.S</a><span class="keyword"> with </span><span class="keyword">type </span>'a <a href="../../../Caqti_response_sig/module-type-S/index.html#type-future">future</a> := <span class="type-var">'a</span> <a href="index.html#type-future">future</a></code></div><div class="doc"></div></div><div class="spec val" id="val-call"><a href="#val-call" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>call : f:((<span class="type-var">'b</span>, <span class="type-var">'m</span>) <a href="Response/index.html#type-t">Response.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'e</span>) Stdlib.result <a href="index.html#type-future">future</a>) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'m</span>) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, [&gt; <a href="../../../Caqti_error/index.html#type-call">Caqti_error.call</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p><code class="code">call ~f request params</code> performs <code class="code">request</code> with parameters <code class="code">params</code>
invoking <code class="code">f</code> to process the result. The argument of <code class="code">f</code> is only valid
during the call to <code class="code">f</code>, and must not be returned or operated on by other
threads.</p></div></div><h3>Transactions</h3><div class="spec val" id="val-start"><a href="#val-start" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>start : unit <span class="keyword">&#8209;&gt;</span> (unit, [&gt; <a href="../../../Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Starts a transaction if supported by the underlying database, otherwise
does nothing.</p></div></div><div class="spec val" id="val-commit"><a href="#val-commit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>commit : unit <span class="keyword">&#8209;&gt;</span> (unit, [&gt; <a href="../../../Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Commits the current transaction if supported by the underlying database,
otherwise does nothing.</p></div></div><div class="spec val" id="val-rollback"><a href="#val-rollback" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>rollback : unit <span class="keyword">&#8209;&gt;</span> (unit, [&gt; <a href="../../../Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Rolls back a transaction if supported by the underlying database,
otherwise does nothing.</p></div></div><h3>Disconnection and Reuse</h3><div class="spec val" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>disconnect : unit <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Calling <code class="code">disconnect ()</code> closes the connection to the database and frees
up related resources.</p></div></div><div class="spec val" id="val-validate"><a href="#val-validate" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>validate : unit <span class="keyword">&#8209;&gt;</span> bool <a href="index.html#type-future">future</a></code></div><div class="doc"><p>For internal use by <a href="../../../Caqti_pool/index.html">Caqti_pool</a>. Tries to ensure the validity of the
connection and must return <code class="code">false</code> if unsuccessful.</p></div></div><div class="spec val" id="val-check"><a href="#val-check" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>check : (bool <span class="keyword">&#8209;&gt;</span> unit) <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>For internal use by <a href="../../../Caqti_pool/index.html">Caqti_pool</a>. Called after a connection has been
used. <code class="code">check f</code> must call <code class="code">f ()</code> exactly once with an argument
indicating whether to keep the connection in the pool or discard it.</p></div></div></details></div><div class="spec val" id="val-driver_info"><a href="#val-driver_info" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>driver_info : <a href="../../../Caqti_driver_info/index.html#type-t">Caqti_driver_info.t</a></code></div><div class="doc"><p>Information about the driver providing this connection module.</p></div></div><h3>Retrieval Convenience</h3><p>These are shortcuts for <a href="index.html#val-call">call</a> combined with retrieval functions from
<a href="../../../Caqti_response_sig/module-type-S/index.html">Caqti_response_sig.S</a> of the same name.</p><div class="spec val" id="val-exec"><a href="#val-exec" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>exec : (<span class="type-var">'a</span>, unit, [&lt; `Zero ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (unit, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-exec">Response.exec</a>, this sends a request to the
database and checks that no rows are returned.</p></div></div><div class="spec val" id="val-find"><a href="#val-find" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `One ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span>, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-find">Response.find</a>, this sends a request to the
database, checks that a single row is returned, and extracts it.</p></div></div><div class="spec val" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find_opt : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> option, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-find_opt">Response.find_opt</a>, this sends a request to the
database, checks that at most one row is returned, and extracts it if
present.</p></div></div><div class="spec val" id="val-fold"><a href="#val-fold" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>fold : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One | `Many ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-fold">Response.fold</a>, this sends a request to the
database and folds over the result rows.</p></div></div><div class="spec val" id="val-fold_s"><a href="#val-fold_s" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>fold_s : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One | `Many ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'e</span>) Stdlib.result <a href="index.html#type-future">future</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-fold_s">Response.fold_s</a>, this sends a request to the
database and folds concurrently over the result rows.</p><p>Please be aware of possible deadlocks when using resources from the
callback. In particular, if the same connection pool is invoked as the
one used to obtain the current connection, it will deadlock if the pool
has just run out of connections. An alternative is to collect the rows
first e.g. with <a href="index.html#val-fold">fold</a> and do the nested queries after exiting.</p></div></div><div class="spec val" id="val-iter_s"><a href="#val-iter_s" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>iter_s : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One | `Many ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'e</span>) Stdlib.result <a href="index.html#type-future">future</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (unit, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p>Combining <a href="index.html#val-call">call</a> with <a href="Response/index.html#val-iter_s">Response.iter_s</a>, this sends a request to the
database and iterates concurrently over the result rows. Please see the
warning in <a href="index.html#val-fold_s">fold_s</a> about resource usage in the callback.</p></div></div><div class="spec val" id="val-collect_list"><a href="#val-collect_list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>collect_list : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One | `Many ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> list, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p><code class="code">collect_list request param</code> performs a <a href="index.html#val-call">call</a> on <code class="code">request</code>, extracting
the result as a list.</p></div></div><div class="spec val" id="val-rev_collect_list"><a href="#val-rev_collect_list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>rev_collect_list : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, [&lt; `Zero | `One | `Many ]) <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> list, [&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]<span class="keyword"> as </span>e) Stdlib.result <a href="index.html#type-future">future</a></code></div><div class="doc"><p><code class="code">rev_collect_list request param</code> performs a <a href="index.html#val-call">call</a> on <code class="code">request</code>,
extracting the result as a reversed list. This is more efficient than
find_list and fits well with a subsequent <span class="xref-unresolved" title="unresolved reference to &quot;List.rev_map&quot;">List.rev_map</span>, though it
may not matter much in practise.</p></div></div></body></html>